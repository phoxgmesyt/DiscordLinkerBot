name: Validate Code

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm install

      - name: Check syntax
        run: |
          echo "âœ… Checking JavaScript syntax..."
          npm list discord.js dotenv rcon.js

      - name: Verify required files
        run: |
          echo "Checking required files..."
          [ -f "index.js" ] && echo "âœ… index.js" || echo "âŒ index.js missing"
          [ -f "package.json" ] && echo "âœ… package.json" || echo "âŒ package.json missing"
          [ -f ".env.example" ] && echo "âœ… .env.example" || echo "âŒ .env.example missing"
          [ -f "Dockerfile" ] && echo "âœ… Dockerfile" || echo "âŒ Dockerfile missing"
          [ -f "ecosystem.config.js" ] && echo "âœ… ecosystem.config.js" || echo "âŒ ecosystem.config.js missing"
          [ -d "commands" ] && echo "âœ… commands/" || echo "âŒ commands/ missing"

      - name: Validate config structure
        run: |
          echo "Validating config structure..."
          node -e "let cfg; try { cfg = require('./config.json'); console.log('Using config.json'); } catch(e) { try { cfg = require('./config_example.json'); console.log('config.json missing, using config_example.json'); } catch(e2) { console.log('No config.json or config_example.json found. Relying on environment variables.'); cfg = {}; } } const clientId = cfg.clientId || process.env.CLIENT_ID || process.env.CLIENTID || process.env.CLIENT_ID; const guildId = cfg.guildId || process.env.GUILD_ID || process.env.GUILDID || process.env.GUILD_ID; console.log('clientId:', clientId || 'none'); console.log('guildId:', guildId || 'none'); if(!clientId) { console.error('âŒ clientId not set in config.json or environment (CLIENT_ID)'); process.exit(1); } if(!guildId) { console.error('âŒ guildId not set in config.json or environment (GUILD_ID)'); process.exit(1); } console.log('âœ… config validated');"

      - name: Summary
        run: |
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… All validations passed!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸš€ Ready to deploy to Replit"
